
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LeadEvent",
  "description": "Schema for validating incoming lead events from all sources.",
  "type": "object",
  "required": ["event_id", "source", "received_at", "payload"],
  "properties": {
    "event_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the event."
    },
    "idempotency_key": {
      "type": "string",
      "description": "A unique key to prevent duplicate processing. Can be client-supplied or server-generated."
    },
    "tenant_id": {
      "type": "string",
      "description": "Identifier for the business unit or client tenant."
    },
    "source": {
      "type": "string",
      "description": "The origin of the lead event.",
      "enum": ["web_form", "chatbot", "mobile", "stripe", "calendly", "iframe", "api"]
    },
    "received_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the event was received by the ingestion API."
    },
    "user_ip": {
      "type": "string",
      "description": "The IP address of the user submitting the form."
    },
    "user_agent": {
      "type": "string",
      "description": "The user agent string from the client's browser."
    },
    "payload": {
      "type": "object",
      "required": ["email", "submission_type"],
      "properties": {
        "first_name": { "type": "string" },
        "last_name": { "type": "string" },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone": { "type": "string" },
        "message": { "type": "string" },
        "submission_type": {
          "type": "string",
          "description": "A descriptor for the specific form or action, e.g., 'contact-us', 'newsletter-signup'."
        },
        "utm": {
          "type": "object",
          "properties": {
            "utm_source": { "type": "string" },
            "utm_medium": { "type": "string" },
            "utm_campaign": { "type": "string" },
            "utm_content": { "type": "string" },
            "utm_term": { "type": "string" }
          }
        },
        "consent": {
          "type": "boolean",
          "description": "Indicates if the user has provided consent for processing their data. Should be checked before processing."
        },
        "metadata": {
          "type": "object",
          "description": "An open object for any additional, non-standard data from the source."
        }
      }
    }
  }
}
